# /security - セキュリティレビュー

コードベースのセキュリティ監査を実行する。

## 対象領域

### 1. 認証・認可（Clerk）
- [ ] 認証ミドルウェアが全保護ルートに適用されているか
- [ ] `clerkMiddleware()` の設定が適切か
- [ ] パブリックルートが意図通りか（`publicRoutes` 設定）
- [ ] セッション管理が安全か

### 2. API セキュリティ
- [ ] 全APIルートで認証チェックが行われているか
- [ ] Rate limiting が実装されているか
- [ ] CORS設定が適切か
- [ ] 入力バリデーションが行われているか（Zod等）

### 3. データベース（Drizzle/Neon）
- [ ] SQLインジェクション対策（パラメータ化クエリ）
- [ ] 機密データの暗号化
- [ ] Row Level Security (RLS) の適用状況

### 4. 決済（Stripe）
- [ ] Webhookシグネチャ検証
- [ ] 金額の改ざん防止
- [ ] 顧客データの適切な取り扱い

### 5. 環境変数・シークレット
- [ ] `.env.local` がgitignoreに含まれているか
- [ ] ハードコードされたシークレットがないか
- [ ] 本番環境の環境変数が適切に設定されているか

### 6. フロントエンド
- [ ] XSS対策（dangerouslySetInnerHTMLの使用箇所）
- [ ] CSRFトークンの実装
- [ ] Sensitive情報がクライアントに露出していないか

### 7. 依存関係
- [ ] `npm audit` で脆弱性チェック
- [ ] 古いパッケージの更新推奨

## 実行手順

1. **スコープ確認**
   - `$ARGUMENTS` があれば特定領域に絞る
   - なければ全領域をチェック

2. **静的解析**
   - 上記チェックリストに基づきコードを検査
   - `grep` でパターンマッチング
   - 問題箇所をファイル:行番号で特定

3. **依存関係チェック**
   ```bash
   npm audit
   ```

4. **レポート作成**
   ```markdown
   # Security Review Report

   ## Critical Issues
   - [問題1]: ファイル:行番号 - 説明

   ## Warnings
   - [警告1]: ファイル:行番号 - 説明

   ## Recommendations
   - [推奨1]: 説明

   ## Passed Checks
   - [チェック項目]: OK
   ```

5. **修正提案**
   - Critical/Warningの問題に対して具体的な修正案を提示

## 出力

セキュリティレポートをMarkdown形式で出力し、問題があれば修正を提案する。
